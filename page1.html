<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>词条统计 - 私人时间记录器</title>
    <!-- 使用 Tailwind CSS v3，以支持更多现代化的工具类 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        /* 为加载动画和 Toast 添加平滑过渡 */
        .transition-all {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
    <script>
        // 更新 Tailwind 配置以使用更现代的颜色
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // 使用更柔和的品牌色调
                        primary: {
                            '50': '#eff6ff', '100': '#dbeafe', '200': '#bfdbfe', '300': '#93c5fd', '400': '#60a5fa', '500': '#3b82f6', '600': '#2563eb', '700': '#1d4ed8', '800': '#1e40af', '900': '#1e3a8a',
                        },
                        success: '#22c55e', // a brighter green
                        danger: '#ef4444', // a brighter red
                        warning: '#f97316',
                        // 奖牌颜色
                        gold: '#f59e0b',
                        silver: '#a1a1aa',
                        bronze: '#d97706',
                    },
                }
            }
        }
    </script>
</head>
<!-- [美化] 使用更柔和的背景色 slate-100 -->
<body class="bg-slate-100 min-h-screen flex flex-col font-sans">

    <!-- [美化] 应用主界面: 改为白色背景，底部加阴影，更轻盈 -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-slate-800 flex items-center">
                <!-- [美化] 图标使用品牌色 -->
                <i class="fa fa-bar-chart text-primary-500 mr-3"></i>
                备注词条统计
            </h1>
            <!-- [美化] 返回按钮样式优化，更像一个可点击的按钮 -->
            <a href="./index.html" class="bg-slate-200 text-slate-700 hover:bg-slate-300 transition-colors flex items-center text-sm font-semibold py-1.5 px-3 rounded-lg">
                <i class="fa fa-arrow-left mr-2"></i>
                返回主页
            </a>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-6 sm:py-8">
        <!-- [美化] 调整容器最大宽度，在大屏幕上更舒适 -->
        <div class="max-w-3xl mx-auto space-y-6">

            <!-- [美化] 卡片样式优化：更柔和的阴影和边框 -->
            <div class="bg-white rounded-xl shadow-md border border-slate-200">
                <!-- [美化] 卡片头部样式，增加分割线 -->
                <div class="p-5 border-b border-slate-200">
                    <h2 class="text-lg font-semibold text-slate-800">词条出现次数排行</h2>
                    <p class="text-sm text-slate-500 mt-1">统计所有记录中备注的使用频率。</p>
                </div>

                <!-- [美化] 内容区域增加内边距 -->
                <div id="stats-container" class="p-3 sm:p-5">
                    <p class="text-slate-500 text-center py-8">正在检查配置...</p>
                </div>
            </div>

        </div>
    </main>

    <!-- [美化] Toast 通知样式优化，增加图标和过渡效果 -->
    <div id="toast" class="fixed bottom-5 right-5 flex items-center text-white py-3 px-5 rounded-lg shadow-xl opacity-0 translate-y-10 z-50 transition-all">
        <div id="toast-icon" class="mr-3"></div>
        <p id="toast-message"></p>
    </div>

    <!-- [美化] 页脚样式，与背景融为一体 -->
    <footer class="text-slate-500 py-6 mt-auto">
        <div class="container mx-auto px-4 text-center text-sm">
            © 私人时间记录器
        </div>
    </footer>

    <script>
        // --- 配置变量 (无变化) ---
        let config = { GITHUB_USERNAME: "", GIST_ID: "", GITHUB_PAT: "" };
        let records = [];

        // --- 配置管理函数 (逻辑无变化，提示信息美化) ---
        function loadConfig() {
            const savedConfig = localStorage.getItem('timeRecorderConfig');
            if (savedConfig) {
                config = JSON.parse(savedConfig);
                return true;
            } else {
                const container = document.getElementById('stats-container');
                // [美化] 空状态/错误状态的显示效果
                container.innerHTML = `
                    <div class="text-center py-10 px-4">
                        <i class="fa fa-cogs text-4xl text-warning mb-4"></i>
                        <h3 class="text-lg font-semibold text-slate-700">未找到进阶信息</h3>
                        <p class="text-slate-500 my-2">请先前往主页查看进阶方法</p>
                        <a href="./page0.html" class="mt-4 inline-block bg-primary-500 text-white py-2 px-5 rounded-lg hover:bg-primary-600 transition-colors font-semibold">
                            前往进阶
                        </a>
                    </div>
                `;
                return false;
            }
        }

        // --- 工具函数 (Toast 功能增强) ---
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            const toastIcon = document.getElementById('toast-icon');

            toastMessage.textContent = message;

            // [美化] 根据类型设置背景色和图标
            toast.classList.remove('bg-success', 'bg-danger', 'bg-slate-800', 'bg-warning');
            let iconHtml = '';
            switch (type) {
                case 'success':
                    toast.classList.add('bg-success');
                    iconHtml = '<i class="fa fa-check-circle"></i>';
                    break;
                case 'error':
                    toast.classList.add('bg-danger');
                    iconHtml = '<i class="fa fa-times-circle"></i>';
                    break;
                case 'warning':
                    toast.classList.add('bg-warning');
                    iconHtml = '<i class="fa fa-exclamation-triangle"></i>';
                    break;
                default:
                    toast.classList.add('bg-slate-800');
                    iconHtml = '<i class="fa fa-info-circle"></i>';
            }
            toastIcon.innerHTML = iconHtml;

            toast.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-10');
            }, 3000);
        }

        // --- Gist API 核心函数 (逻辑无变化，提示信息美化) ---
        async function loadRecordsFromGist() {
            if (!config.GIST_ID) return;

            // [美化] 使用 Spinner 加载动画
            document.getElementById('stats-container').innerHTML = `
                <div class="flex justify-center items-center py-12 text-slate-500">
                    <i class="fa fa-spinner fa-spin text-2xl mr-3"></i>
                    <span>正在从云端同步数据...</span>
                </div>
            `;
            showToast("正在同步数据...", "info");

            try {
                const response = await fetch(`https://gist.githubusercontent.com/${config.GITHUB_USERNAME}/${config.GIST_ID}/raw/records.json?t=${new Date().getTime()}`);
                if (!response.ok) throw new Error(`无法加载Gist: ${response.statusText}`);
                const data = await response.json();
                records = Array.isArray(data) ? data : [];
                processAndRenderStats();
                showToast("数据同步成功！", "success");
            } catch (error) {
                console.error("加载记录失败:", error);
                showToast("同步失败，请检查配置或网络。", "error");
                document.getElementById('stats-container').innerHTML = `
                    <div class="text-center py-10 px-4 text-danger">
                        <i class="fa fa-cloud-download text-4xl mb-4"></i>
                        <h3 class="text-lg font-semibold">数据同步失败</h3>
                        <p class="my-2">请检查网络连接或配置后刷新重试。</p>
                    </div>
                `;
            }
        }

        // [美化] 新增一个辅助函数，用于生成排名徽章
        function getRankBadge(index) {
            const rank = index + 1;
            if (rank === 1) {
                return `<span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-gold text-white font-bold text-sm"><i class="fa fa-trophy"></i></span>`;
            }
            if (rank === 2) {
                return `<span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-silver text-white font-bold text-sm">2</span>`;
            }
            if (rank === 3) {
                return `<span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-bronze text-white font-bold text-sm">3</span>`;
            }
            return `<span class="text-slate-500 font-medium">${rank}</span>`;
        }

        // --- 核心统计与渲染函数 (渲染逻辑大改，使其更美观) ---
        function processAndRenderStats() {
            const container = document.getElementById('stats-container');

            if (records.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-10 px-4">
                        <i class="fa fa-folder-open-o text-4xl text-slate-400 mb-4"></i>
                        <h3 class="text-lg font-semibold text-slate-700">暂无记录</h3>
                        <p class="text-slate-500 my-2">开始记录你的第一条时间数据吧！</p>
                    </div>
                `;
                return;
            }

            const remarkCounts = new Map();
            records.forEach(record => {
                const remark = record.remark ? record.remark.trim() : '';
                if (remark) {
                    remarkCounts.set(remark, (remarkCounts.get(remark) || 0) + 1);
                }
            });

            if (remarkCounts.size === 0) {
                container.innerHTML = `
                    <div class="text-center py-10 px-4">
                        <i class="fa fa-commenting-o text-4xl text-slate-400 mb-4"></i>
                        <h3 class="text-lg font-semibold text-slate-700">没有带备注的记录</h3>
                        <p class="text-slate-500 my-2">所有记录均无备注，无法进行统计。</p>
                    </div>
                `;
                return;
            }

            const sortedStats = Array.from(remarkCounts.entries())
                .map(([remark, count]) => ({ remark, count }))
                .sort((a, b) => b.count - a.count);

            container.innerHTML = ''; // 清空容器
            const table = document.createElement('table');
            // [美化] 优化表格整体样式
            table.className = 'w-full text-sm text-left text-slate-600';

            table.innerHTML = `
                <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                    <tr>
                        <th scope="col" class="px-6 py-3 w-16 text-center">排名</th>
                        <th scope="col" class="px-6 py-3">备注词条</th>
                        <th scope="col" class="px-6 py-3 w-24 text-center">次数</th>
                    </tr>
                </thead>
            `;

            const tbody = document.createElement('tbody');
            sortedStats.forEach((stat, index) => {
                const row = document.createElement('tr');
                // [美化] 使用斑马纹，优化 hover 效果和边框
                row.className = 'bg-white border-b border-slate-200 hover:bg-slate-50';
                row.innerHTML = `
                    <td class="px-6 py-4 text-center">${getRankBadge(index)}</td>
                    <td class="px-6 py-4 font-medium text-slate-900">${stat.remark}</td>
                    <td class="px-6 py-4 text-center">
                        <!-- [美化] 使用彩色标签展示次数 -->
                        <span class="bg-primary-100 text-primary-800 text-xs font-semibold px-2.5 py-1 rounded-full">
                            ${stat.count}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });

            table.appendChild(tbody);
            container.appendChild(table);
        }

        // --- 初始化 (无变化) ---
        document.addEventListener('DOMContentLoaded', () => {
            if (loadConfig()) {
                loadRecordsFromGist();
            }
        });
    </script>
</body>
</html>
